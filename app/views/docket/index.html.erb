<div class="page-header">
	<h1>My Docket</h1>
</div>

<% @days_of_this_week.each do |day| %>
	<div class="panel panel-default">
		<div class="panel-heading">
			<div class="row">
				<div class="col-md-8">
					<b><%= Date::DAYNAMES[day.wday] %></b>, the <b><%= day.mday.ordinalize %></b> of <b><%= Date::MONTHNAMES[day.month] %></b>
				</div>

				<% day_assignments = current_user.day_assignments(day) %>
				<% day_exams = current_user.day_exams(day) %>
				<% day_assignments_and_exams = day_assignments + day_exams %>
				<% day_events = current_user.day_events(day) %>

				<% day_items = day_assignments + day_exams + day_events %>

				<div class="col-md-4">
					<span class="badge"><%= day_assignments.count %></span>
					<span class="badge"><%= day_exams.count %></span>
					<span class="badge"><%= day_events.count %></span>

					~

					<span class="badge"><%= day_items.count %></span>
				</div>
			</div>
		</div>

		<div class="panel-body row">
			<div class="col-md-8">
				<% if day_assignments_and_exams.count == 0 %>
					No assignments or exams today!
				<% else %>
					<% if day_exams.count == 0 %>
						No exams today!
					<% else %>
						<div class="row">
							<div class="col-md-12">
								<b>Exams</b>
							</div>
							
							<% sort_by_period(current_user.classes_with_exams_on(day)).each do |classroom| %>
								<% class_exams = classroom.day_exams(day) %>
								
								<% if class_exams.count == 1 %>
									<div class="col-md-1"></div>

									<% class_exam = class_exams.first %>

									<div class="col-md-11">
										<%= link_to classroom.course_name, classroom_path(classroom) %>

										-

										<%= link_to class_exam.name, exam_path(class_exam) %>
									</div>
								<% elsif class_exams.count > 0 %>
									<div class="col-md-1"></div>

									<div class="col-md-11">
										<%= link_to classroom.course_name, classroom_path(classroom) %>
									</div>
									
									<% class_exams.each do |exam| %>
										<div class="col-md-2"></div>

										<div class="col-md-10">
											<%= link_to exam.name, exam_path(exam) %>
										</div>
									<% end %>
								<% end %>
							<% end %>
						</div>
					<% end %>

					<% if day_assignments.count == 0 %>
						No assignments today!
					<% else %>
						<div class="row">
							<div class="col-md-12">
								<b>Assignments</b>
							</div>
							
							<% sort_by_period(current_user.classes_with_exams_on(day)).each do |classroom| %>
								<% class_assignments = classroom.day_assignments(day) %>
								
								<% if class_assignments.count == 1 %>
									<div class="col-md-1"></div>
									
									<% class_assignment = class_assignments.first %>

									<div class="col-md-11">
										<%= link_to classroom.course_name, classroom_path(classroom) %>

										-

										<%= link_to class_assignment.name, assignment_path(class_assignment) %>
									</div>
								<% elsif class_assignments.count > 0 %>
									<div class="col-md-1"></div>

									<div class="col-md-11">
										<%= link_to classroom.course_name, classroom_path(classroom) %>
									</div>
									
									<% class_assignments.each do |assignment| %>
										<div class="col-md-2"></div>

										<div class="col-md-10">
											<%= link_to assignment.name, exam_path(assignment) %>
										</div>
									<% end %>
								<% end %>
							<% end %>
						</div>
					<% end %>
				<% end %>
			</div>

			<div class="col-md-4">
				<% if day_events.count == 0 %>
					No events.
				<% else %>
					<div class="row">
						<% day_events.each do |event| %>
							<div class="col-md-12">
								<%= event.date.strftime("%l:%M %p") %>
								-
								<%= link_to event.name, event %>
							</div>
						<% end %>
					</div>
				<% end %>
			</div>
		</div>
	</div>
<% end %>
